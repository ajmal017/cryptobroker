#!/usr/bin/env ruby

require 'cryptobroker'

Cryptobroker.new('../dev-config.yml')

investors = {}
Cryptobroker::Model::Investor.where(enabled: true).order(:name).each do |investor|
  investors[investor.name] = investor.balances.preload(:trade).last(10).to_a
end

investors.each do |investor, balances|
  puts "--- investor: #{investor} ---"
  balances.each do |balance|
    balance_str = 'base: %12.8f, quote: %12.8f, time: %s' % [balance.base, balance.quote, balance.timestamp]
    transaction_str = ''
    transaction_str = ' (%s at %.8f)' % [balance.trade.type, balance.trade.price] unless balance.trade.nil?
    puts balance_str + transaction_str
  end
  puts
end

